# miniCycle Security Headers Configuration for Nginx
# Version: 1.353
# Created: November 13, 2025
#
# Usage: Include this file in your main nginx.conf or site configuration
# Example: include /path/to/miniCycle/nginx-security.conf;

# ===================================================================
# CONTENT SECURITY POLICY (CSP)
# ===================================================================
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data: https:; connect-src 'self'; frame-ancestors 'none'; base-uri 'self'; form-action 'self'; upgrade-insecure-requests;" always;

# ===================================================================
# X-FRAME-OPTIONS
# ===================================================================
add_header X-Frame-Options "DENY" always;

# ===================================================================
# X-CONTENT-TYPE-OPTIONS
# ===================================================================
add_header X-Content-Type-Options "nosniff" always;

# ===================================================================
# X-XSS-PROTECTION
# ===================================================================
add_header X-XSS-Protection "1; mode=block" always;

# ===================================================================
# REFERRER-POLICY
# ===================================================================
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# ===================================================================
# PERMISSIONS-POLICY
# ===================================================================
add_header Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), accelerometer=()" always;

# ===================================================================
# STRICT-TRANSPORT-SECURITY (HSTS)
# ===================================================================
# Only enable if using HTTPS
# add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

# ===================================================================
# HIDE SERVER VERSION
# ===================================================================
server_tokens off;

# ===================================================================
# CACHE CONTROL
# ===================================================================
location ~* \.(html)$ {
    add_header Cache-Control "no-cache, no-store, must-revalidate";
    expires 0;
}

location ~* \.(js)$ {
    add_header Cache-Control "public, max-age=3600";
    expires 1h;
}

location ~* \.(css)$ {
    add_header Cache-Control "public, max-age=3600";
    expires 1h;
}

location ~* \.(jpg|jpeg|png|gif|ico|svg)$ {
    add_header Cache-Control "public, max-age=2592000";
    expires 30d;
}

location ~* \.(woff|woff2|ttf|otf|eot)$ {
    add_header Cache-Control "public, max-age=31536000";
    expires 1y;
}

location ~* \.(json)$ {
    add_header Cache-Control "no-cache";
    expires 0;
}

# ===================================================================
# PROTECT SENSITIVE FILES
# ===================================================================
location ~ /\. {
    deny all;
}

location ~ \.(bak|config|sql|fla|psd|ini|log|sh|inc|swp|dist)$ {
    deny all;
}

location ~ (package\.json|package-lock\.json|\.env|\.git.*|\.DS_Store)$ {
    deny all;
}
